import{u as g,s as v,c as _,b as l,e as u,I as x,J as I,a as P,r as m,i as A,d as h}from"./index-Cfi2m2dj.js";import{u as L}from"./toastMessage-Bd_7BpTT.js";import{_ as T}from"./Pagination-D2fuxtQW.js";import{m as D,_ as R}from"./DelModal-CqDZmyv4.js";const r={props:{coupon:Object,isNew:Boolean},data(){return{tempCoupon:{},due_date:""}},methods:{restInput(){this.tempCoupon.percent<=0&&(this.tempCoupon.percent=1)}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon;const t=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=t},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[D]};function N(t,e,o,a,n,M,s,i){e(`<div${v(_({class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},a))}><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="exampleModalLabel">`),n.isNew?e("<span>新增優惠卷</span>"):e("<span>編輯優惠卷</span>"),e(`</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="mb-3"><label for="title">標題</label><input type="text" class="form-control" id="title"${l("value",s.tempCoupon.title)} placeholder="請輸入標題"></div><div class="mb-3"><label for="coupon_code">優惠碼</label><input type="text" class="form-control" id="coupon_code"${l("value",s.tempCoupon.code)} placeholder="請輸入優惠碼"></div><div class="mb-3"><label for="due_date">到期日</label><input type="date" class="form-control" id="due_date"${l("value",s.due_date)}></div><div class="mb-3"><label for="price">折扣百分比</label><input type="number" class="form-control" id="price" min="0"${l("value",s.tempCoupon.percent)} placeholder="請輸入折扣百分比"></div><div class="mb-3"><div class="form-check"><input class="form-check-input" type="checkbox"${x(I(s.tempCoupon.is_enabled,1))?" checked":""} id="is_enabled"><label class="form-check-label" for="is_enabled"> 是否啟用 </label></div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal"> 關閉 </button><button type="button" class="btn btn-primary">${u(n.isNew?"新增優惠卷":"更新優惠券")}</button></div></div></div></div>`)}r.ssrRender=N;const f=r.setup;r.setup=(t,e)=>{const o=g();return(o.modules||(o.modules=new Set)).add("src/components/CouponModal.vue"),f?f(t,e):void 0};const S={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_APIPATH:"fabio20"},{VITE_API:p,VITE_APIPATH:c}=S,b={components:{CouponModal:r,DelModal:R,Pagination:T},props:{config:Object},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isLoading:!1,isNew:!1,pagination:{}}},methods:{...P(L,["pushMessage"]),openCouponModal(t,e){this.isNew=t,this.isNew?this.tempCoupon={due_date:new Date().getTime()/1e3}:this.tempCoupon={...e},this.$refs.couponModal.openModal()},openDelCouponModal(t){this.tempCoupon={...t},this.$refs.delModal.openModal()},getCoupons(){const t=`${p}api/${c}/admin/coupons`;this.$http.get(t,this.tempProduct).then(e=>{this.coupons=e.data.coupons,this.pagination=e.data.pagination}).catch(e=>{this.isLoading=!1,this.pushMessage({style:"success",title:"取得優惠券",content:e.response.data.message})})},updateCoupon(t){let e=`${p}api/${c}/admin/coupon`,o="post",a=t;this.isNew||(e=`${p}api/${c}/admin/coupon/${this.tempCoupon.id}`,o="put",a=this.tempCoupon),this.$http[o](e,{data:a}).then(n=>{this.isLoading=!1,this.pushMessage({style:"success",title:"新增優惠券",content:n.data.message}),this.getCoupons(),this.$refs.couponModal.hideModal()}).catch(n=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"新增優惠券",content:n.response.data.message})})},delCoupon(){const t=`${p}/api/${c}/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(t).then(e=>{this.isLoading=!1,this.pushMessage({style:"success",title:"刪除優惠券",content:e.data.message}),this.$refs.delModal.hideModal(),this.getCoupons()}).catch(e=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"刪除優惠券",content:e.response.data.message})})}},created(){this.getCoupons()}};function k(t,e,o,a,n,M,s,i){const $=m("CouponModal"),y=m("DelModal"),w=m("Pagination");e(`<div${v(_({class:"container"},a))}><div class="text-end mt-4"><button class="btn btn-primary" type="button"> 建立新的優惠券 </button></div><table class="table mt-4"><thead><tr><th>名稱</th><th>折扣百分比</th><th>到期日</th><th>是否啟用</th><th>編輯</th></tr></thead><tbody><!--[-->`),A(s.coupons,(d,E)=>{e(`<tr><td>${u(d.title)}</td><td>${u(d.percent)}%</td><td>${u(t.$filters.date(d.due_date))}</td><td>`),d.is_enabled===1?e('<span class="text-success">啟用</span>'):e('<span class="text-muted">未啟用</span>'),e('</td><td><div class="btn-group"><button type="button" class="btn btn-outline-primary btn-sm"> 編輯 </button><button type="button" class="btn btn-outline-danger btn-sm"> 刪除 </button></div></td></tr>')}),e("<!--]--></tbody></table>"),e(h($,{coupon:s.tempCoupon,"is-new":s.isNew,ref:"couponModal",onUpdateCoupon:i.updateCoupon},null,o)),e(h(y,{item:s.tempCoupon,ref:"delModal",onDelItem:i.delCoupon},null,o)),e(h(w,{pages:s.pagination,onEmitPages:i.getCoupons},null,o)),e("</div>")}b.ssrRender=k;const C=b.setup;b.setup=(t,e)=>{const o=g();return(o.modules||(o.modules=new Set)).add("src/views/DashBordView/CouponsView.vue"),C?C(t,e):void 0};export{b as default};
