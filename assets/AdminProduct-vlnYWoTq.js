import{_ as U,a as M,M as D,c as a,b as t,i as f,j as c,v as u,g as C,F as x,f as P,H as L,o as i,e as m,r as _,t as g}from"./index-B2CUwak0.js";import{u as w}from"./toastMessage-CgHJWb5D.js";import{P as I}from"./Pagination-BTOQWExa.js";import{D as A}from"./DelModal-Dr1L6hQG.js";const N={data(){return{pModal:null,isLoading:!1,tempProduct:{},status:{fileUploading:!1}}},props:["product","isNew"],methods:{...M(w,["pushMessage"]),openM(){this.pModal.show()},closeM(){this.pModal.hide()},updateProduct(){const l=this.isNew?"https://vue3-course-api.hexschool.io/v2//api/fabio20/admin/product":`https://vue3-course-api.hexschool.io/v2//api/fabio20/admin/product/${this.product.id}`,o=this.isNew?"post":"put";this.isLoading=!0,this.$http[o](l,{data:this.product}).then(e=>{alert(e.data.message),this.isLoading=!1,this.closeM(),this.$emit("update")}).catch(e=>{alert(e.res.data.message),this.isLoading=!1})},newImages(){this.product.imagesUrl=[],this.product.imagesUrl.push("")},uploadFile(){const l=this.$refs.fileInput.files[0],o=new FormData;o.append("file-to-upload",l);const e="https://vue3-course-api.hexschool.io/v2/api/fabio20/admin/upload";this.status.fileUploading=!0,this.$http.post(e,o,{headers:{"Content-Type":"multipart/form-data"}}).then(p=>{this.status.fileUploading=!1,this.tempProduct.imageUrl=p.data.imageUrl,this.$refs.fileInput.value="",this.pushMessage({style:"success",title:"圖片上傳結果",content:p.data.message})}).catch(p=>{this.status.fileUploading=!1,this.pushMessage({style:"danger",title:"圖片上傳結果",content:p.response.data.message})})}},mounted(){this.pModal=new D(this.$refs.productModal)}},T={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},F={class:"modal-dialog modal-xl"},E={class:"modal-content border-0"},$={class:"modal-header bg-dark text-white"},B={id:"productModalLabel",class:"modal-title"},H={key:0},S={key:1},j=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},q={class:"row mb-3"},G={class:"col-sm-4"},J={class:"form-group mb-3"},K=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),O=["src"],Q={class:"mb-3"},R={for:"customFile",class:"form-label"},W={key:0,class:"spinner-border m-5",role:"status"},X=t("span",{class:"visually-hidden"},"Loading...",-1),Y=[X],Z={key:0},tt={class:"form-group"},et=["for"],ot=["id","onUpdate:modelValue"],st=["src"],lt={key:0},at={key:1},it={class:"col-sm-8"},dt={class:"form-group mb-3"},nt=t("label",{for:"title",class:"form-label"},"標題",-1),ct={class:"row mb-3"},rt={class:"form-group col-md-6"},ut=t("label",{for:"category",class:"form-label"},"分類",-1),pt={class:"form-group col-md-6"},ht=t("label",{for:"unit",class:"form-label"},"單位",-1),mt={class:"row mb-3"},_t={class:"form-group col-md-6"},gt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),bt={class:"form-group col-md-6"},ft=t("label",{for:"price",class:"form-label"},"售價",-1),vt=t("hr",null,null,-1),yt={class:"form-group mb-3"},Ut=t("label",{for:"description",class:"form-label"},"產品描述",-1),Mt={class:"form-group mb-3"},xt=t("label",{for:"content",class:"form-label"},"說明內容",-1),Pt={class:"form-group mb-3"},wt={class:"form-check"},kt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Vt={class:"modal-footer"},Dt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Ct(l,o,e,p,n,d){return i(),a("div",T,[t("div",F,[t("div",E,[t("div",$,[t("h5",B,[e.isNew?(i(),a("span",H,"新增產品")):(i(),a("span",S,"編輯產品"))]),j]),t("div",z,[t("div",q,[t("div",G,[t("div",J,[K,c(t("input",{id:"imageUrl","onUpdate:modelValue":o[0]||(o[0]=s=>e.product.imageUrl=s),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[u,e.product.imageUrl]]),t("img",{class:"img-fluid",src:e.product.imageUrl,alt:"product pic"},null,8,O)]),t("div",Q,[t("label",R,[C("或 上傳圖片 "),n.status.fileUploading?(i(),a("div",W,Y)):f("",!0)]),t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:o[1]||(o[1]=(...s)=>d.uploadFile&&d.uploadFile(...s))},null,544)]),Array.isArray(e.product.imagesUrl)?(i(),a("div",Z,[(i(!0),a(x,null,P(e.product.imagesUrl,(s,h)=>(i(),a("div",{class:"mb-1",key:h},[t("div",tt,[t("label",{for:`imagesUrl${h}`,class:"form-label"},"圖片網址",8,et),c(t("input",{id:`imagesUrl${h}`,"onUpdate:modelValue":b=>e.product.imagesUrl[h]=b,type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,8,ot),[[u,e.product.imagesUrl[h]]])]),t("img",{class:"img-fluid",src:s,alt:"pic"},null,8,st)]))),128)),!e.product.imagesUrl.length||e.product.imagesUrl[e.product.imagesUrl.length-1]?(i(),a("div",lt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:o[2]||(o[2]=s=>e.product.imagesUrl.push("")),type:"button"}," 新增圖片 ")])):(i(),a("div",at,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:o[3]||(o[3]=s=>e.product.imagesUrl.pop()),type:"button"}," 刪除圖片 ")]))])):f("",!0)]),t("div",it,[t("div",dt,[nt,c(t("input",{id:"title","onUpdate:modelValue":o[4]||(o[4]=s=>e.product.title=s),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[u,e.product.title]])]),t("div",ct,[t("div",rt,[ut,c(t("input",{id:"category","onUpdate:modelValue":o[5]||(o[5]=s=>e.product.category=s),type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[u,e.product.category]])]),t("div",pt,[ht,c(t("input",{id:"unit","onUpdate:modelValue":o[6]||(o[6]=s=>e.product.unit=s),type:"text",class:"form-control",placeholder:"請輸入單位"},null,512),[[u,e.product.unit]])])]),t("div",mt,[t("div",_t,[gt,c(t("input",{id:"origin_price","onUpdate:modelValue":o[7]||(o[7]=s=>e.product.origin_price=s),type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[u,e.product.origin_price,void 0,{number:!0}]])]),t("div",bt,[ft,c(t("input",{id:"price","onUpdate:modelValue":o[8]||(o[8]=s=>e.product.price=s),type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[u,e.product.price,void 0,{number:!0}]])])]),vt,t("div",yt,[Ut,c(t("textarea",{id:"description","onUpdate:modelValue":o[9]||(o[9]=s=>e.product.description=s),type:"text",class:"form-control",placeholder:"請輸入產品描述"},`\r
                `,512),[[u,e.product.description]])]),t("div",Mt,[xt,c(t("textarea",{id:"content","onUpdate:modelValue":o[10]||(o[10]=s=>e.product.content=s),type:"text",class:"form-control",placeholder:"請輸入說明內容"},`\r
                `,512),[[u,e.product.content]])]),t("div",Pt,[t("div",wt,[c(t("input",{id:"is_enabled","onUpdate:modelValue":o[11]||(o[11]=s=>e.product.is_enabled=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[L,e.product.is_enabled]]),kt])])])])]),t("div",Vt,[Dt,t("button",{type:"button",class:"btn btn-primary",onClick:o[12]||(o[12]=(...s)=>d.updateProduct&&d.updateProduct(...s))}," 確認 ")])])])],512)}const Lt=U(N,[["render",Ct]]),It={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_APIPATH:"fabio20"},{VITE_API:v,VITE_APIPATH:y}=It,At={data(){return{products:[],catchProduct:{imagesUrl:[]},isNew:!1,pagination:{},isLoading:!1}},methods:{...M(w,["pushMessage"]),getData(l=1){const o=`${v}/api/${y}/admin/products?page=${l}`;this.isLoading=!0,this.$http.get(o).then(e=>{const{products:p,pagination:n}=e.data;this.products=p,this.pagination=n,this.isLoading=!1,this.pushMessage({style:"success",title:"成功取得產品資訊",content:e.data.message})}).catch(e=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得產品資訊失敗",content:e.response.data.message})})},openModal(l,o){l==="new"?(this.catchProduct={imagesUrl:[]},this.isNew=!0,this.$refs.productbox.openM()):l==="edit"?(this.catchProduct={...o},this.isNew=!1,this.$refs.productbox.openM()):l==="delete"&&(this.catchProduct={...o},this.$refs.delbox.openCloseModal())},openDelModal(l){this.catchProduct={...l},this.$refs.delbox.openModal()},delProduct(){this.$http.delete(`${v}api/${y}/admin/product/${this.catchProduct.id}`).then(()=>{this.$refs.delbox.hideModal(),this.getData()}).catch(l=>{alert(l.response.data.message)})}},components:{Pagination:I,ProductModal:Lt,DelModal:A},created(){this.getData()}},Nt={class:"container"},Tt={class:"text-end mt-4"},Ft={class:"table mt-4"},Et=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),$t={class:"text-end"},Bt={class:"text-end"},Ht={key:0,class:"text-success"},St={key:1},jt={class:"btn-group"},zt=["onClick"],qt=["onClick"];function Gt(l,o,e,p,n,d){const s=_("VueLoading"),h=_("pagination"),b=_("product-modal"),k=_("DelModal");return i(),a("div",Nt,[t("div",Tt,[t("button",{type:"button",onClick:o[0]||(o[0]=r=>d.openModal("new")),class:"btn btn-primary"}," 建立新的產品 ")]),t("table",Ft,[Et,t("tbody",null,[m(s,{active:n.isLoading,"z-index":1060},null,8,["active"]),(i(!0),a(x,null,P(n.products,r=>(i(),a("tr",{key:r.id},[t("td",null,g(r.category),1),t("td",null,g(r.title),1),t("td",$t,g(r.origin_price),1),t("td",Bt,g(r.price),1),t("td",null,[r.is_enabled?(i(),a("span",Ht,"啟用")):(i(),a("span",St,"未啟用"))]),t("td",null,[t("div",jt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:V=>d.openModal("edit",r)}," 編輯 ",8,zt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:V=>d.openDelModal(r)}," 刪除 ",8,qt)])])]))),128))])]),m(h,{pages:n.pagination,onEmitPages:d.getData},null,8,["pages","onEmitPages"]),m(b,{ref:"productbox",product:n.catchProduct,"is-new":n.isNew,onUpdate:d.getData},null,8,["product","is-new","onUpdate"]),m(k,{onDelItem:d.delProduct,ref:"delbox",item:n.catchProduct,onUpdate:d.getData},null,8,["onDelItem","item","onUpdate"])])}const Rt=U(At,[["render",Gt]]);export{Rt as default};
