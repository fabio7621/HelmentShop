import{a as x,M as I,u as M,s as $,c as w,b as o,i as P,e as d,I as A,J as R,r as u,d as p}from"./index-Cfi2m2dj.js";import{u as U}from"./toastMessage-Bd_7BpTT.js";import{_ as C}from"./Pagination-D2fuxtQW.js";import{_ as T}from"./DelModal-CqDZmyv4.js";const m={data(){return{pModal:null,isLoading:!1,tempProduct:{},status:{fileUploading:!1}}},props:["product","isNew"],methods:{...x(U,["pushMessage"]),openM(){this.pModal.show()},closeM(){this.pModal.hide()},updateProduct(){const a=this.isNew?"https://vue3-course-api.hexschool.io/v2//api/fabio20/admin/product":`https://vue3-course-api.hexschool.io/v2//api/fabio20/admin/product/${this.product.id}`,t=this.isNew?"post":"put";this.isLoading=!0,this.$http[t](a,{data:this.product}).then(e=>{alert(e.data.message),this.isLoading=!1,this.closeM(),this.$emit("update")}).catch(e=>{alert(e.res.data.message),this.isLoading=!1})},newImages(){this.product.imagesUrl=[],this.product.imagesUrl.push("")},uploadFile(){const a=this.$refs.fileInput.files[0],t=new FormData;t.append("file-to-upload",a);const e="https://vue3-course-api.hexschool.io/v2/api/fabio20/admin/upload";this.status.fileUploading=!0,this.$http.post(e,t,{headers:{"Content-Type":"multipart/form-data"}}).then(l=>{this.status.fileUploading=!1,this.tempProduct.imageUrl=l.data.imageUrl,this.$refs.fileInput.value="",this.pushMessage({style:"success",title:"圖片上傳結果",content:l.data.message})}).catch(l=>{this.status.fileUploading=!1,this.pushMessage({style:"danger",title:"圖片上傳結果",content:l.response.data.message})})}},mounted(){this.pModal=new I(this.$refs.productModal)}};function V(a,t,e,l,s,_,i,r){t(`<div${$(w({id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},l))}><div class="modal-dialog modal-xl"><div class="modal-content border-0"><div class="modal-header bg-dark text-white"><h5 id="productModalLabel" class="modal-title">`),s.isNew?t("<span>新增產品</span>"):t("<span>編輯產品</span>"),t(`</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="row mb-3"><div class="col-sm-4"><div class="form-group mb-3"><label for="imageUrl" class="form-label">主要圖片</label><input id="imageUrl"${o("value",s.product.imageUrl)} type="text" class="form-control" placeholder="請輸入圖片連結"><img class="img-fluid"${o("src",s.product.imageUrl)} alt="product pic"></div><div class="mb-3"><label for="customFile" class="form-label">或 上傳圖片 `),i.status.fileUploading?t('<div class="spinner-border m-5" role="status"><span class="visually-hidden">Loading...</span></div>'):t("<!---->"),t('</label><input type="file" id="customFile" class="form-control"></div>'),Array.isArray(s.product.imagesUrl)?(t("<div><!--[-->"),P(s.product.imagesUrl,(b,c)=>{t(`<div class="mb-1"><div class="form-group"><label${o("for",`imagesUrl${c}`)} class="form-label">圖片網址</label><input${o("id",`imagesUrl${c}`)}${o("value",s.product.imagesUrl[c])} type="text" class="form-control" placeholder="請輸入圖片連結"></div><img class="img-fluid"${o("src",b)} alt="pic"></div>`)}),t("<!--]-->"),!s.product.imagesUrl.length||s.product.imagesUrl[s.product.imagesUrl.length-1]?t('<div><button class="btn btn-outline-primary btn-sm d-block w-100" type="button"> 新增圖片 </button></div>'):t('<div><button class="btn btn-outline-danger btn-sm d-block w-100" type="button"> 刪除圖片 </button></div>'),t("</div>")):t("<!---->"),t(`</div><div class="col-sm-8"><div class="form-group mb-3"><label for="title" class="form-label">標題</label><input id="title"${o("value",s.product.title)} type="text" class="form-control" placeholder="請輸入標題"></div><div class="row mb-3"><div class="form-group col-md-6"><label for="category" class="form-label">分類</label><input id="category"${o("value",s.product.category)} type="text" class="form-control" placeholder="請輸入分類"></div><div class="form-group col-md-6"><label for="unit" class="form-label">單位</label><input id="unit"${o("value",s.product.unit)} type="text" class="form-control" placeholder="請輸入單位"></div></div><div class="row mb-3"><div class="form-group col-md-6"><label for="origin_price" class="form-label">原價</label><input id="origin_price"${o("value",s.product.origin_price)} type="number" min="0" class="form-control" placeholder="請輸入原價"></div><div class="form-group col-md-6"><label for="price" class="form-label">售價</label><input id="price"${o("value",s.product.price)} type="number" min="0" class="form-control" placeholder="請輸入售價"></div></div><hr><div class="form-group mb-3"><label for="description" class="form-label">產品描述</label><textarea id="description" type="text" class="form-control" placeholder="請輸入產品描述">${d(s.product.description)}</textarea></div><div class="form-group mb-3"><label for="content" class="form-label">說明內容</label><textarea id="content" type="text" class="form-control" placeholder="請輸入說明內容">${d(s.product.content)}</textarea></div><div class="form-group mb-3"><div class="form-check"><input id="is_enabled"${A(R(s.product.is_enabled,1))?" checked":""} class="form-check-input" type="checkbox"><label class="form-check-label" for="is_enabled">是否啟用</label></div></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"> 取消 </button><button type="button" class="btn btn-primary"> 確認 </button></div></div></div></div>`)}m.ssrRender=V;const f=m.setup;m.setup=(a,t)=>{const e=M();return(e.modules||(e.modules=new Set)).add("src/components/ProductModal.vue"),f?f(a,t):void 0};const k={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_APIPATH:"fabio20"},{VITE_API:g,VITE_APIPATH:v}=k,h={data(){return{products:[],catchProduct:{imagesUrl:[]},isNew:!1,pagination:{},isLoading:!1}},methods:{...x(U,["pushMessage"]),getData(a=1){const t=`${g}/api/${v}/admin/products?page=${a}`;this.isLoading=!0,this.$http.get(t).then(e=>{const{products:l,pagination:s}=e.data;this.products=l,this.pagination=s,this.isLoading=!1,this.pushMessage({style:"success",title:"成功取得產品資訊",content:e.data.message})}).catch(e=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"取得產品資訊失敗",content:e.response.data.message})})},openModal(a,t){a==="new"?(this.catchProduct={imagesUrl:[]},this.isNew=!0,this.$refs.productbox.openM()):a==="edit"?(this.catchProduct={...t},this.isNew=!1,this.$refs.productbox.openM()):a==="delete"&&(this.catchProduct={...t},this.$refs.delbox.openCloseModal())},openDelModal(a){this.catchProduct={...a},this.$refs.delbox.openModal()},delProduct(){this.$http.delete(`${g}api/${v}/admin/product/${this.catchProduct.id}`).then(()=>{this.$refs.delbox.hideModal(),this.getData()}).catch(a=>{alert(a.response.data.message)})}},components:{Pagination:C,ProductModal:m,DelModal:T},created(){this.getData()}};function E(a,t,e,l,s,_,i,r){const b=u("VueLoading"),c=u("pagination"),L=u("product-modal"),D=u("DelModal");t(`<div${$(w({class:"container"},l))}><div class="text-end mt-4"><button type="button" class="btn btn-primary"> 建立新的產品 </button></div><table class="table mt-4"><thead><tr><th width="120">分類</th><th>產品名稱</th><th width="120">原價</th><th width="120">售價</th><th width="100">是否啟用</th><th width="120">編輯</th></tr></thead><tbody>`),t(p(b,{active:i.isLoading,"z-index":1060},null,e)),t("<!--[-->"),P(i.products,n=>{t(`<tr><td>${d(n.category)}</td><td>${d(n.title)}</td><td class="text-end">${d(n.origin_price)}</td><td class="text-end">${d(n.price)}</td><td>`),n.is_enabled?t('<span class="text-success">啟用</span>'):t("<span>未啟用</span>"),t('</td><td><div class="btn-group"><button type="button" class="btn btn-outline-primary btn-sm"> 編輯 </button><button type="button" class="btn btn-outline-danger btn-sm"> 刪除 </button></div></td></tr>')}),t("<!--]--></tbody></table>"),t(p(c,{pages:i.pagination,onEmitPages:r.getData},null,e)),t(p(L,{ref:"productbox",product:i.catchProduct,"is-new":i.isNew,onUpdate:r.getData},null,e)),t(p(D,{onDelItem:r.delProduct,ref:"delbox",item:i.catchProduct,onUpdate:r.getData},null,e)),t("</div>")}h.ssrRender=E;const y=h.setup;h.setup=(a,t)=>{const e=M();return(e.modules||(e.modules=new Set)).add("src/views/DashBordView/AdminProduct.vue"),y?y(a,t):void 0};export{h as default};
