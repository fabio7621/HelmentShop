import{_ as y,M as C,c as s,b as e,i as f,t as l,F as m,f as O,j as k,H as M,o,a as P,e as _,r as p,D,g as V}from"./index-Dr1hX6is.js";import{u as L}from"./toastMessage-CsUj_ydo.js";import{D as w}from"./DelModal-DOMsT80C.js";import{P as I}from"./Pagination-CmgyeFZI.js";const E={data(){return{orderM:null,tempOrder:{}}},props:["order"],emits:["update-paid"],methods:{openOderModal(){this.orderM.show()},closeOderModal(){this.orderM.hide()}},watch:{order(){this.tempOrder=this.order}},mounted(){this.orderM=new C(this.$refs.Ordermodal)}},A={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"Ordermodal"},T={class:"modal-dialog modal-xl",role:"document"},U={class:"modal-content border-0"},N=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),S={class:"modal-body"},B={class:"row"},H={class:"col-md-4"},j=e("h3",null,"用戶資料",-1),q={class:"table"},z={key:0},F=e("th",{style:{width:"100px"}},"姓名",-1),G=e("th",null,"Email",-1),J=e("th",null,"電話",-1),K=e("th",null,"地址",-1),Q={class:"col-md-8"},R=e("h3",null,"訂單細節",-1),W={class:"table"},X=e("th",{style:{width:"100px"}},"訂單編號",-1),Y=e("th",null,"下單時間",-1),Z=e("th",null,"付款時間",-1),ee={key:0},te={key:1},se=e("th",null,"付款狀態",-1),oe={key:0,class:"text-success"},de={key:1,class:"text-muted"},le=e("th",null,"總金額",-1),ne=e("h3",null,"選購商品",-1),re={class:"table"},ae=e("thead",null,[e("tr")],-1),ie={class:"text-end"},ce={class:"d-flex justify-content-end"},he={class:"form-check"},ue={class:"form-check-label",for:"flexCheckDefault"},_e={key:0},pe={key:1},me={class:"modal-footer"},be=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ge(d,r,c,u,t,h){return o(),s("div",A,[e("div",T,[e("div",U,[N,e("div",S,[e("div",B,[e("div",H,[j,e("table",q,[t.tempOrder.user?(o(),s("tbody",z,[e("tr",null,[F,e("td",null,l(t.tempOrder.user.name),1)]),e("tr",null,[G,e("td",null,l(t.tempOrder.user.email),1)]),e("tr",null,[J,e("td",null,l(t.tempOrder.user.tel),1)]),e("tr",null,[K,e("td",null,l(t.tempOrder.user.address),1)])])):f("",!0)])]),e("div",Q,[R,e("table",W,[e("tbody",null,[e("tr",null,[X,e("td",null,l(t.tempOrder.id),1)]),e("tr",null,[Y,e("td",null,l(d.$filters.date(t.tempOrder.create_at)),1)]),e("tr",null,[Z,e("td",null,[t.tempOrder.paid_date?(o(),s("span",ee,l(d.$filters.date(t.tempOrder.paid_date)),1)):(o(),s("span",te,"時間不正確"))])]),e("tr",null,[se,e("td",null,[t.tempOrder.is_paid?(o(),s("strong",oe,"已付款")):(o(),s("span",de,"尚未付款"))])]),e("tr",null,[le,e("td",null,l(d.$filters.currency(t.tempOrder.total)),1)])])]),ne,e("table",re,[ae,e("tbody",null,[(o(!0),s(m,null,O(t.tempOrder.products,a=>(o(),s("tr",{key:a.id},[e("th",null,l(a.product.title),1),e("td",null,l(a.qty)+" / "+l(a.product.unit),1),e("td",ie,l(d.$filters.currency(a.final_total)),1)]))),128))])]),e("div",ce,[e("div",he,[k(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":r[0]||(r[0]=a=>t.tempOrder.is_paid=a)},null,512),[[M,t.tempOrder.is_paid]]),e("label",ue,[t.tempOrder.is_paid?(o(),s("span",_e,"已付款")):(o(),s("span",pe,"未付款"))])])])])])]),e("div",me,[be,e("button",{type:"button",class:"btn btn-primary",onClick:r[1]||(r[1]=a=>d.$emit("update-paid",t.tempOrder))}," 修改付款狀態 ")])])])],512)}const fe=y(E,[["render",ge]]),Oe={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_APIPATH:"fabio20"},{VITE_API:b,VITE_APIPATH:g}=Oe,ye={data(){return{orders:{},tempOrder:{},pagination:{},isLoading:!1,currentPage:1}},methods:{...P(L,["pushMessage"]),getOrder(d=1){const r=`${b}api/${g}/admin/orders?page=${d}`;this.isLoading=!0,this.$http.get(r).then(c=>{this.orders=c.data.orders,this.pagination=c.data.pagination,this.isLoading=!1}).catch(c=>{this.pushMessage({style:"danger",title:"錯誤訊息",content:c.response.data.message}),this.isLoading=!1})},openModal(d){this.$refs.ordermodal.openOderModal(),this.tempOrder={...d}},openDelOrderModal(d){this.tempOrder={...d},this.$refs.delbox.openModal()},delOrder(){const d=`${b}api/${g}/admin/order/${this.tempOrder.id}`;this.$http.delete(d).then(r=>{this.$refs.delbox.hideModal(),this.getOrder()})},updatePaid(d){const r=`${b}api/${g}/admin/order/${d.id}`,c={is_paid:d.is_paid};this.$http.put(r,{data:c}).then(u=>{this.isLoading=!1,this.$refs.ordermodal.closeOderModal(),this.pushMessage({style:"success",title:"更新付款狀態",content:u.data.message}),this.getOrder()}).catch(u=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"錯誤訊息",content:u.response.data.message})})}},components:{DelModal:w,OrderModal:fe,Pagination:I},created(){this.getOrder()}},ke={class:"container"},Me={class:"table mt-4"},ve=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),xe=["textContent"],$e={class:"list-unstyled"},Ce={class:"text-right"},Pe={class:"form-check form-switch"},De=["id","onUpdate:modelValue","onChange"],Ve=["for"],Le={key:0},we={key:1},Ie={class:"btn-group"},Ee=["onClick"],Ae=["onClick"];function Te(d,r,c,u,t,h){const a=p("VueLoading"),v=p("OrderModal"),x=p("DelModal"),$=p("pagination");return o(),s("div",ke,[_(a,{active:t.isLoading,"z-index":1060},null,8,["active"]),e("table",Me,[ve,e("tbody",null,[(o(!0),s(m,null,O(t.orders,n=>(o(),s(m,{key:n.id},[t.orders.length?(o(),s("tr",{key:0,class:D({"text-secondary":!n.is_paid})},[e("td",null,l(d.$filters.date(n.create_at)),1),e("td",null,[n.user?(o(),s("span",{key:0,textContent:l(n.user.email)},null,8,xe)):f("",!0)]),e("td",null,[e("ul",$e,[(o(!0),s(m,null,O(n.products,i=>(o(),s("li",{key:i.id},l(i.product.title)+" 數量："+l(i.qty)+" "+l(i.product.unit),1))),128))])]),e("td",Ce,l(n.total),1),e("td",null,[e("div",Pe,[V(" 付款狀態 "),k(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${n.id}`,"onUpdate:modelValue":i=>n.is_paid=i,onChange:i=>h.updatePaid(n)},null,40,De),[[M,n.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${n.id}`},[n.is_paid?(o(),s("span",Le,"已付款")):(o(),s("span",we,"未付款"))],8,Ve)])]),e("td",null,[e("div",Ie,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:i=>h.openModal(n)}," 檢視 ",8,Ee),e("button",{onClick:i=>h.openDelOrderModal(n),class:"btn btn-outline-danger btn-sm",type:"button"}," 刪除 ",8,Ae)])])],2)):f("",!0)],64))),128))])]),_(v,{order:t.tempOrder,ref:"ordermodal",onUpdatePaid:h.updatePaid},null,8,["order","onUpdatePaid"]),_(x,{onDelItem:h.delOrder,ref:"delbox",item:t.tempOrder,onUpdate:h.getOrder},null,8,["onDelItem","item","onUpdate"]),_($,{pages:t.pagination,onEmitPages:h.getOrder},null,8,["pages","onEmitPages"])])}const He=y(ye,[["render",Te]]);export{He as default};
