import{M as I,u as y,s as M,c as x,g,e as r,i as u,I as _,K as A,a as R,r as n,d as c,C as D,b as O}from"./index-Cfi2m2dj.js";import{u as S}from"./toastMessage-Bd_7BpTT.js";import{_ as E}from"./DelModal-CqDZmyv4.js";import{_ as T}from"./Pagination-D2fuxtQW.js";const p={data(){return{orderM:null,tempOrder:{}}},props:["order"],emits:["update-paid"],methods:{openOderModal(){this.orderM.show()},closeOderModal(){this.orderM.hide()}},watch:{order(){this.tempOrder=this.order}},mounted(){this.orderM=new I(this.$refs.Ordermodal)}};function V(s,t,d,o,w,k,e,l){t(`<div${M(x({class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"Ordermodal"},o))}><div class="modal-dialog modal-xl" role="document"><div class="modal-content border-0"><div class="modal-header bg-dark text-white"><h5 class="modal-title" id="exampleModalLabel"><span>訂單細節</span></h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><div class="row"><div class="col-md-4"><h3>用戶資料</h3><table class="table">`),e.tempOrder.user?t(`<tbody><tr><th style="${g({width:"100px"})}">姓名</th><td>${r(e.tempOrder.user.name)}</td></tr><tr><th>Email</th><td>${r(e.tempOrder.user.email)}</td></tr><tr><th>電話</th><td>${r(e.tempOrder.user.tel)}</td></tr><tr><th>地址</th><td>${r(e.tempOrder.user.address)}</td></tr></tbody>`):t("<!---->"),t(`</table></div><div class="col-md-8"><h3>訂單細節</h3><table class="table"><tbody><tr><th style="${g({width:"100px"})}">訂單編號</th><td>${r(e.tempOrder.id)}</td></tr><tr><th>下單時間</th><td>${r(s.$filters.date(e.tempOrder.create_at))}</td></tr><tr><th>付款時間</th><td>`),e.tempOrder.paid_date?t(`<span>${r(s.$filters.date(e.tempOrder.paid_date))}</span>`):t("<span>時間不正確</span>"),t("</td></tr><tr><th>付款狀態</th><td>"),e.tempOrder.is_paid?t('<strong class="text-success">已付款</strong>'):t('<span class="text-muted">尚未付款</span>'),t(`</td></tr><tr><th>總金額</th><td>${r(s.$filters.currency(e.tempOrder.total))}</td></tr></tbody></table><h3>選購商品</h3><table class="table"><thead><tr></tr></thead><tbody><!--[-->`),u(e.tempOrder.products,i=>{t(`<tr><th>${r(i.product.title)}</th><td>${r(i.qty)} / ${r(i.product.unit)}</td><td class="text-end">${r(s.$filters.currency(i.final_total))}</td></tr>`)}),t(`<!--]--></tbody></table><div class="d-flex justify-content-end"><div class="form-check"><input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"${_(Array.isArray(e.tempOrder.is_paid)?A(e.tempOrder.is_paid,""):e.tempOrder.is_paid)?" checked":""}><label class="form-check-label" for="flexCheckDefault">`),e.tempOrder.is_paid?t("<span>已付款</span>"):t("<span>未付款</span>"),t('</label></div></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"> 取消 </button><button type="button" class="btn btn-primary"> 修改付款狀態 </button></div></div></div></div>')}p.ssrRender=V;const v=p.setup;p.setup=(s,t)=>{const d=y();return(d.modules||(d.modules=new Set)).add("src/components/OrderModal.vue"),v?v(s,t):void 0};const q={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_APIPATH:"fabio20"},{VITE_API:h,VITE_APIPATH:b}=q,f={data(){return{orders:{},tempOrder:{},pagination:{},isLoading:!1,currentPage:1}},methods:{...R(S,["pushMessage"]),getOrder(s=1){const t=`${h}api/${b}/admin/orders?page=${s}`;this.isLoading=!0,this.$http.get(t).then(d=>{this.orders=d.data.orders,this.pagination=d.data.pagination,this.isLoading=!1}).catch(d=>{this.pushMessage({style:"danger",title:"錯誤訊息",content:d.response.data.message}),this.isLoading=!1})},openModal(s){this.$refs.ordermodal.openOderModal(),this.tempOrder={...s}},openDelOrderModal(s){this.tempOrder={...s},this.$refs.delbox.openModal()},delOrder(){const s=`${h}api/${b}/admin/order/${this.tempOrder.id}`;this.$http.delete(s).then(t=>{this.$refs.delbox.hideModal(),this.getOrder()})},updatePaid(s){const t=`${h}api/${b}/admin/order/${s.id}`,d={is_paid:s.is_paid};this.$http.put(t,{data:d}).then(o=>{this.isLoading=!1,this.$refs.ordermodal.closeOderModal(),this.pushMessage({style:"success",title:"更新付款狀態",content:o.data.message}),this.getOrder()}).catch(o=>{this.isLoading=!1,this.pushMessage({style:"danger",title:"錯誤訊息",content:o.response.data.message})})}},components:{DelModal:E,OrderModal:p,Pagination:T},created(){this.getOrder()}};function B(s,t,d,o,w,k,e,l){const i=n("VueLoading"),L=n("OrderModal"),P=n("DelModal"),C=n("pagination");t(`<div${M(x({class:"container"},o))}>`),t(c(i,{active:e.isLoading,"z-index":1060},null,d)),t('<table class="table mt-4"><thead><tr><th>購買時間</th><th>Email</th><th>購買款項</th><th>應付金額</th><th>是否付款</th><th>編輯</th></tr></thead><tbody><!--[-->'),u(e.orders,a=>{t("<!--[-->"),e.orders.length?(t(`<tr class="${D({"text-secondary":!a.is_paid})}"><td>${r(s.$filters.date(a.create_at))}</td><td>`),a.user?t(`<span>${r(a.user.email)}</span>`):t("<!---->"),t('</td><td><ul class="list-unstyled"><!--[-->'),u(a.products,m=>{t(`<li>${r(m.product.title)} 數量：${r(m.qty)} ${r(m.product.unit)}</li>`)}),t(`<!--]--></ul></td><td class="text-right">${r(a.total)}</td><td><div class="form-check form-switch"> 付款狀態 <input class="form-check-input" type="checkbox"${O("id",`paidSwitch${a.id}`)}${_(Array.isArray(a.is_paid)?A(a.is_paid,null):a.is_paid)?" checked":""}><label class="form-check-label"${O("for",`paidSwitch${a.id}`)}>`),a.is_paid?t("<span>已付款</span>"):t("<span>未付款</span>"),t('</label></div></td><td><div class="btn-group"><button class="btn btn-outline-primary btn-sm" type="button"> 檢視 </button><button class="btn btn-outline-danger btn-sm" type="button"> 刪除 </button></div></td></tr>')):t("<!---->"),t("<!--]-->")}),t("<!--]--></tbody></table>"),t(c(L,{order:e.tempOrder,ref:"ordermodal",onUpdatePaid:l.updatePaid},null,d)),t(c(P,{onDelItem:l.delOrder,ref:"delbox",item:e.tempOrder,onUpdate:l.getOrder},null,d)),t(c(C,{pages:e.pagination,onEmitPages:l.getOrder},null,d)),t("</div>")}f.ssrRender=B;const $=f.setup;f.setup=(s,t)=>{const d=y();return(d.modules||(d.modules=new Set)).add("src/views/DashBordView/AdminOder.vue"),$?$(s,t):void 0};export{f as default};
